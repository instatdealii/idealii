

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 3: Solving the heat equation in parallel &mdash; ideal.II  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/maths_admonition.css?v=597dd67d" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example 4: Solving the Navier-Stokes equations in parallel" href="step-4.html" />
    <link rel="prev" title="Example 2: Solving the linear Stokes equation" href="step-2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #450d54" >

          
          
          <a href="../index.html">
            
              <img src="../_static/idealii_logo_text.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get ideal.II</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mathematical foundations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../maths/function_spaces.html">Space-time function spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maths/discretization.html">Finite element discretization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Example overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="step-1.html">Example 1: Solving the heat equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="step-2.html">Example 2: Solving the linear Stokes equation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example 3: Solving the heat equation in parallel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#support-points-for-discontinuous-elements">Support points for discontinuous elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#concepts-around-distributed-computing">Concepts around distributed computing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-commented-program">The commented program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#include-files">include files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ideal-ii-includes">ideal.II includes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deal-ii-includes">deal.II includes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trilinos-and-c-includes">Trilinos and C++ includes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#space-time-functions">Space-time functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-step3-class">The Step3 class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step3-step3">Step3::Step3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-run">Step3::run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-make-grid">Step3::make_grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-time-marching">Step3::time_marching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-setup-system-on-slab">Step3::setup_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-assemble-system-on-slab">Step3::assemble_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-solve-system-on-slab">Step3::solve_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-process-results-on-slab">Step3::process_results_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step3-output-results-on-slab">Step3::output_results_on_slab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-main-function">The main function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#convergence-studies">Convergence studies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#h-refinement">h-refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#k-refinement">k-refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kh-refinement">kh-refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparison-of-support-types">Comparison of support types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-plain-program">The plain program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="step-4.html">Example 4: Solving the Navier-Stokes equations in parallel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Doxygen API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/index.html">Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/namespaces.html">Namespace List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/classes.html">Class List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/files.html">File List</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #450d54" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ideal.II</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example 3: Solving the heat equation in parallel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/step-3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-3-solving-the-heat-equation-in-parallel">
<span id="step-3"></span><h1>Example 3: Solving the heat equation in parallel<a class="headerlink" href="#example-3-solving-the-heat-equation-in-parallel" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id4">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#support-points-for-discontinuous-elements" id="id5">Support points for discontinuous elements</a></p></li>
<li><p><a class="reference internal" href="#concepts-around-distributed-computing" id="id6">Concepts around distributed computing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-commented-program" id="id7">The commented program</a></p>
<ul>
<li><p><a class="reference internal" href="#include-files" id="id8">include files</a></p>
<ul>
<li><p><a class="reference internal" href="#ideal-ii-includes" id="id9">ideal.II includes</a></p></li>
<li><p><a class="reference internal" href="#deal-ii-includes" id="id10">deal.II includes</a></p></li>
<li><p><a class="reference internal" href="#trilinos-and-c-includes" id="id11">Trilinos and C++ includes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#space-time-functions" id="id12">Space-time functions</a></p></li>
<li><p><a class="reference internal" href="#the-step3-class" id="id13">The Step3 class</a></p>
<ul>
<li><p><a class="reference internal" href="#step3-step3" id="id14">Step3::Step3</a></p></li>
<li><p><a class="reference internal" href="#step3-run" id="id15">Step3::run</a></p></li>
<li><p><a class="reference internal" href="#step3-make-grid" id="id16">Step3::make_grid</a></p></li>
<li><p><a class="reference internal" href="#step3-time-marching" id="id17">Step3::time_marching</a></p></li>
<li><p><a class="reference internal" href="#step3-setup-system-on-slab" id="id18">Step3::setup_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step3-assemble-system-on-slab" id="id19">Step3::assemble_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step3-solve-system-on-slab" id="id20">Step3::solve_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step3-process-results-on-slab" id="id21">Step3::process_results_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step3-output-results-on-slab" id="id22">Step3::output_results_on_slab</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-main-function" id="id23">The main function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#results" id="id24">Results</a></p>
<ul>
<li><p><a class="reference internal" href="#convergence-studies" id="id25">Convergence studies</a></p>
<ul>
<li><p><a class="reference internal" href="#h-refinement" id="id26">h-refinement</a></p></li>
<li><p><a class="reference internal" href="#k-refinement" id="id27">k-refinement</a></p></li>
<li><p><a class="reference internal" href="#kh-refinement" id="id28">kh-refinement</a></p></li>
<li><p><a class="reference internal" href="#comparison-of-support-types" id="id29">Comparison of support types</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-plain-program" id="id30">The plain program</a></p></li>
<li><p><a class="reference internal" href="#references" id="id31">References</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>This problem extends <a class="reference internal" href="step-1.html#step-1"><span class="std std-ref">Example 1: Solving the heat equation</span></a> in a few meaningful ways:</p>
<ul class="simple">
<li><p>The exact solution and right hand side are more challenging compared to a
solution that is linear in time and quadratic in space.</p></li>
<li><p>We change the support points for the temporal discretization.</p></li>
<li><p>The linear algebra is now distributed over multiple MPI processes by using
Trilinos. We will give a short overview over the important concepts,
but for a good in-depth explanation of MPI-parallel simulations we highly
recommend the deal.II ressources
<a class="reference external" href="https://dealii.org/current/doxygen/deal.II/step_40.html">step-40</a>
,which solves the Poisson or stationary heat equation, and the
overview page <a class="reference external" href="https://dealii.org/current/doxygen/deal.II/group__distributed.html">Parallel computing with multiple processors using distributed memory</a>.</p></li>
<li><p>Calculation of the space-time <span class="math notranslate nohighlight">\(L^2\)</span>-error and subsequent convergence
studies.</p></li>
<li><p>Providing a command line interface to set simulation parameters for use in
a script based batch-processing.
This is used to run all the simulations for the convergence studies.</p></li>
</ul>
<section id="support-points-for-discontinuous-elements">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Support points for discontinuous elements</a><a class="headerlink" href="#support-points-for-discontinuous-elements" title="Link to this heading"></a></h3>
<p>For continuous Lagrange finite elements the outermost DoFs are always placed
on the boundary. That way they can be combined with the DoFs of
neighboring elements as they have to have the same values due to the continuity.</p>
<p>For discontinuous elements however, this is no longer necessary.
In the previous examples we have used the default of <code class="docutils literal notranslate"><span class="pre">DGFiniteElement</span></code>
which are support points at the locations of Gauss-Lobatto quadrature points.
This quadrature rule is defined by requiring the first and last quadrature
point to be on the boundary of the interval, like in the continuous case.</p>
<p>Additionally, <em>ideal.II</em> offers the following three values for <code class="docutils literal notranslate"><span class="pre">support_type</span></code></p>
<ul class="simple">
<li><p>Gauss(-Legendre) with no DoFs on the element boundary</p></li>
<li><p>left Gauss-Radau with only the first DoF on the left boundary</p></li>
<li><p>right Gauss-Radau with only the last DoF on the right boundary</p></li>
</ul>
<p>These may provide better approximations as we can see in the results.
However, this introduces some important differences that have to be taken into
account</p>
<ul class="simple">
<li><p>The final value needed for the initial jump of the following slab might not be
on a temporal DoF, so we have to use <code class="docutils literal notranslate"><span class="pre">extract_subvector_at_time_point</span></code>
instead of extracting the final subvector of the slab</p></li>
<li><p>At least one of values needed for the jump values is no longer on a DoF and
we get a larger sparsity pattern. This is handled internally by
<code class="docutils literal notranslate"><span class="pre">make_upwind_sparsity_pattern()</span></code> so you only need to be aware of it.</p></li>
<li><p>The output is no longer at the temporal grid points when using
<code class="docutils literal notranslate"><span class="pre">extract_subvector_at_time_dof</span></code> there. In the future this will be addressed
by a space-time version of <code class="docutils literal notranslate"><span class="pre">DataOutput</span></code>.</p></li>
</ul>
</section>
<section id="concepts-around-distributed-computing">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Concepts around distributed computing</a><a class="headerlink" href="#concepts-around-distributed-computing" title="Link to this heading"></a></h3>
<p>We start by partitioning the spatial mesh and distributing it to
each MPI rank/process.
The Triangulation in <code class="docutils literal notranslate"><span class="pre">parallel::distributed</span></code> provides this functionality.
Then, each spatial element belongs to exactly one rank.
Additionally, each spatial DoF is owned by only one rank.
As a result a DoF can belong to a different rank but is also part of
an owned element and will be needed for assembly.
Therefore, there are two sets of DoF indices:</p>
<ul class="simple">
<li><p>The locally owned DoFs actually owned by the current rank</p></li>
<li><p>The locally relevant DoFs which are all DoFs belonging to a locally owned
element, i.e. the locally owned DoFs plus so called ‘ghost’ DoFs.</p></li>
</ul>
<p>These index sets will be used to initialize distributed vectors and matrices.
Note that only vectors initialized with the smaller locally owned set can be
written into directly to avoid overriding a value on multiple MPI processes.</p>
<p>For the space-time index sets we take the spatial sets obtained from the
<code class="docutils literal notranslate"><span class="pre">DoFHandler</span></code> and shift them by the local temporal DoF index
times the total number of spatial DoFs.
So for a spatial mesh with 8 DoFs of which the indices <span class="math notranslate nohighlight">\((0,3,5,7)\)</span>
are locally owned and a temporal mesh with 3 DoFs, the space-time index set
would be <span class="math notranslate nohighlight">\((0,3,5,7,8,11,13,15,16,19,21,23)\)</span>.
PETSc does not allow for the specification of such an index set,
so only Trilinos is supported in <em>ideal.II</em>.</p>
<p>Since some vectors, like the initial value, are defined on a single time point,
we need to know four index sets in total, two on the spatial and two on the
space-time mesh.</p>
<p>Apart from that, all changes from step-1 to step-3 regarding distributed
computing are standard changes you would also do in a stationary problem.
Some of these are</p>
<ul class="simple">
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">MPI_InitFinalize</span></code> in <code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p></li>
<li><p>Knowing and saving the MPI Communicator.</p></li>
<li><p>Changing the triangulation and linear algebra objects to distributed versions.</p></li>
<li><p>Storing and using index sets during setup .</p></li>
<li><p>Communicating between different locally owned and locally relevant vectors</p></li>
<li><p>Compressing the matrix and vectors after assembly to communicate off-processor
entries.</p></li>
<li><p>Using parallel output functions from <code class="docutils literal notranslate"><span class="pre">dealii::DataOut</span></code></p></li>
</ul>
</section>
</section>
<section id="the-commented-program">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">The commented program</a><a class="headerlink" href="#the-commented-program" title="Link to this heading"></a></h2>
<section id="include-files">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">include files</a><a class="headerlink" href="#include-files" title="Link to this heading"></a></h3>
<section id="ideal-ii-includes">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">ideal.II includes</a><a class="headerlink" href="#ideal-ii-includes" title="Link to this heading"></a></h4>
<p>Here, we use the parallel distributed triangulation and linear algebra
(provided by Trilinos) so we have to use the matching includes.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/distributed/fixed_tria.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/lac/spacetime_trilinos_vector.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
</pre></div>
</div>
<p>All other ideal.II includes are known</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/quadrature_lib.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/time_iterator.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/slab_dof_tools.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/spacetime_dof_handler.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/fe_dg.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/spacetime_fe_values.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/numerics/vector_tools.hh&gt;</span>
</pre></div>
</div>
<p>As we need the support type quite often we shorten this lengthy typename with
an alias</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DGFE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="deal-ii-includes">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">deal.II includes</a><a class="headerlink" href="#deal-ii-includes" title="Link to this heading"></a></h4>
<p>Most includes are the same as before except for the
distributed versions of triangulation and linear algebra objects.
Additionally, we include the conditional output stream to suppress
duplicate output on other processors.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/conditional_ostream.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/function.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/distributed/tria.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_q.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_generator.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/dynamic_sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/full_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparsity_tools.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_solver.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_sparse_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_vector.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/vector.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/numerics/data_out.h&gt;</span>
</pre></div>
</div>
</section>
<section id="trilinos-and-c-includes">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Trilinos and C++ includes</a><a class="headerlink" href="#trilinos-and-c-includes" title="Link to this heading"></a></h4>
<p>To simplify handling of command line arguments
in <code class="docutils literal notranslate"><span class="pre">main()</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Teuchos_CommandLineProcessor.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="space-time-functions">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Space-time functions</a><a class="headerlink" href="#space-time-functions" title="Link to this heading"></a></h3>
<p>The manufactured exact solution <span class="math notranslate nohighlight">\(u\)</span> is described in <a class="reference internal" href="#hartmann1998" id="id1"><span>[Hartmann1998]</span></a>.
The right hand side function is derived by inserting <span class="math notranslate nohighlight">\(u\)</span> into the heat
equation.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ExactSolution</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">ExactSolution</span><span class="p">()</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">  </span><span class="p">{}</span>
<span class="w">  </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">ExactSolution::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                     </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span>
<span class="w">         </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">50.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RightHandSide</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">RightHandSide::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                     </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">double</span><span class="w">       </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="kt">double</span><span class="w">       </span><span class="n">a</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">50.</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">1.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">));</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">dtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">))</span><span class="w"> </span><span class="o">-</span>
<span class="w">                 </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)))</span><span class="w"> </span><span class="o">/</span>
<span class="w">               </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">u_xx</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">-2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                  </span><span class="p">(</span><span class="mf">-2.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)));</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">u_yy</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">-2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                  </span><span class="p">(</span><span class="mf">-2.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dtu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">u_xx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_yy</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="the-step3-class">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">The Step3 class</a><a class="headerlink" href="#the-step3-class" title="Link to this heading"></a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Step3</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">Step3</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">spatial_degree</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">n_ref_space</span><span class="p">,</span>
<span class="w">        </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">support_type</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w">               </span><span class="n">write_vtu</span><span class="p">);</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">run</span><span class="p">();</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">time_marching</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setup_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">solve_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">process_results_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">output_results_on_slab</span><span class="p">();</span>

<span class="w">  </span><span class="n">MPI_Comm</span><span class="w">     </span><span class="n">mpi_comm</span><span class="p">;</span><span class="w">    </span><span class="c1">// MPI Communicator</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w">           </span><span class="c1">// Number of temporal elements</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">;</span><span class="w"> </span><span class="c1">// number of spatial refinements</span>
<span class="w">  </span><span class="kt">bool</span><span class="w">         </span><span class="n">write_vtu</span><span class="p">;</span><span class="w">   </span><span class="c1">// output results?</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">ConditionalOStream</span><span class="w"> </span><span class="n">pout</span><span class="p">;</span><span class="w"> </span><span class="c1">// To allow output only on MPI rank 0</span>
</pre></div>
</div>
<p>The triangulation is now parallel distributed and the matrices and vectors
are provided by Trilinos.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">fixed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="w">                                     </span><span class="n">triangulation</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DoFHandler</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">  </span><span class="n">dof_handler</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">TrilinosVector</span><span class="w"> </span><span class="n">solution</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityPattern</span><span class="w">                            </span><span class="n">slab_sparsity_pattern</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SparseMatrix</span><span class="w">             </span><span class="n">slab_system_matrix</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w">              </span><span class="n">slab_system_rhs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w">              </span><span class="n">slab_initial_value</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">slab</span><span class="p">;</span>
<span class="w">  </span><span class="n">ExactSolution</span><span class="w">                                      </span><span class="n">exact_solution</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w">                                             </span><span class="n">L2_sqr_error</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">dofs_total</span><span class="p">;</span>
</pre></div>
</div>
<p>For parallel communication we need some additional information.
First we need to know which DoF indices are owned by the current MPI rank.
Then, we need to know which indices are relevant, i.e. owned or ghost
entries needed for assembly but belonging to a different rank. We need
those both for the complete slab and for the spatial grid in different
points of the code. Finally, we sometimes need temporary vectors that the
current rank is allowed to write into for communication between different
ranks.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">slab_locally_owned_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">slab_locally_relevant_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">space_locally_owned_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">space_locally_relevant_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">slab_owned_tmp</span><span class="p">;</span>

<span class="w">  </span><span class="k">struct</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">TriaIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tria</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFHandlerIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">                  </span><span class="n">dof</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">TrilinosVectorIterator</span><span class="w">                 </span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">slab_its</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="step3-step3">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Step3::Step3</a><a class="headerlink" href="#step3-step3" title="Link to this heading"></a></h4>
<p>The constructor is almost the same as for step-1 as we are solving the same
PDE. The main differences are</p>
<ul class="simple">
<li><p>A larger set of parameters to support a parameter study,</p></li>
<li><p>Initializing the MPI communicator. Here to world, i.e. all ranks,</p></li>
<li><p>Restricting conditional output to rank 0,</p></li>
<li><p>Allowing the temporal support type to change.</p></li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Step3</span><span class="o">::</span><span class="n">Step3</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">spatial_degree</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">M</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">n_ref_space</span><span class="p">,</span>
<span class="w">             </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">support_type</span><span class="p">,</span>
<span class="w">             </span><span class="kt">bool</span><span class="w">               </span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">pout</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Utilities</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">this_mpi_process</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">triangulation</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">spatial_degree</span><span class="p">),</span>
<span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">       </span><span class="n">support_type</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">(</span><span class="n">n_ref_space</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">write_vtu</span><span class="p">(</span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">slab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">exact_solution</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">L2_sqr_error</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dofs_total</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{}</span>
</pre></div>
</div>
</section>
<section id="step3-run">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Step3::run</a><a class="headerlink" href="#step3-run" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::run</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as before</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="n">time_marching</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-make-grid">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Step3::make_grid</a><a class="headerlink" href="#step3-make-grid" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::make_grid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">space_tria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// Construct an MPI parallel triangulation</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridGenerator</span><span class="o">::</span><span class="n">hyper_cube</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">space_tria</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">refine_global</span><span class="p">(</span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-time-marching">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">Step3::time_marching</a><a class="headerlink" href="#step3-time-marching" title="Link to this heading"></a></h4>
<p>We now want to assess the performance of the different discretizations
so we will calculate local contributions to the <span class="math notranslate nohighlight">\(L^2\)</span> error in
<code class="docutils literal notranslate"><span class="pre">process_results_on_slab()</span></code>.
Additionally, we only do output if <code class="docutils literal notranslate"><span class="pre">write_vtu</span></code> is true.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::time_marching</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="n">solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">triangulation</span><span class="p">.</span><span class="n">M</span><span class="p">());</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">triangulation</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dof_handler</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solution</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******Starting time-stepping*********&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="o">!</span><span class="n">tic</span><span class="p">.</span><span class="n">at_end</span><span class="p">();</span><span class="w"> </span><span class="n">tic</span><span class="p">.</span><span class="n">increment</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Starting time-step (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">startpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">      </span><span class="n">setup_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">solve_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">process_results_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">        </span><span class="n">output_results_on_slab</span><span class="p">();</span>
</pre></div>
</div>
<p>For some support points the final DoF of the slab is no longer at the
final time point. Therefore, we have to calculate the value as a linear
combination of the DoF values at the final temporal element.
This is done by the following extract function.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_point</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">());</span>
<span class="w">      </span><span class="n">slab</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">L2_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">L2_sqr_error</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Total number of space-time DoFs:</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">dofs_total</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;L2_error:</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">L2_error</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-setup-system-on-slab">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Step3::setup_system_on_slab</a><a class="headerlink" href="#step3-setup-system-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::setup_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">distribute_dofs</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Number of degrees of freedom: </span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">()</span>
<span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (space) * &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">()</span>
<span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (time) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>Tally the total amount of space-time</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dofs_total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">();</span>
</pre></div>
</div>
<p>Extract the spatial DoF indices by accessing the <code class="docutils literal notranslate"><span class="pre">spatial()</span></code>
component of the <code class="docutils literal notranslate"><span class="pre">slab::DoFHandler</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">space_locally_owned_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">locally_owned_dofs</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">extract_locally_relevant_dofs</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">(),</span>
<span class="w">                                                  </span><span class="n">space_locally_relevant_dofs</span><span class="p">);</span>
</pre></div>
</div>
<p>The slab DoF indices are extracted in a similar way, but by using functions
provided in ideal.II.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">slab_locally_owned_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">locally_owned_dofs</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_locally_relevant_dofs</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">extract_locally_relevant_dofs</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_owned_tmp</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">slab</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
</pre></div>
</div>
<p>On the first slab the initial value has to be set to the set of
spatially relevant dofs</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">slab_initial_value</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                                </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                                </span><span class="n">mpi_comm</span><span class="p">);</span>
</pre></div>
</div>
<p>We only have write access to locally owned vectors.
Compared to <code class="docutils literal notranslate"><span class="pre">slab_owned_tmp</span></code> we need this temporary vector only on
the first slab for interpolation of the initial value into the FE
space.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">      </span><span class="n">tmp</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>
</pre></div>
</div>
<p>Set time of the exact solution to initial time point
(For a time independent initial value function this is not necessary)</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">exact_solution</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Interpolate the initial value into the FE space</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">(),</span>
<span class="w">                                       </span><span class="n">exact_solution</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">tmp</span><span class="p">);</span>
</pre></div>
</div>
<p>Communicate locally owned initial value to locally relevant vector</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">slab_initial_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>For the interpolation of boundary values we pass the relevant index set.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">slab_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">exact_solution</span><span class="p">,</span>
<span class="w">    </span><span class="n">slab_constraints</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DynamicSparsityPattern</span><span class="w"> </span><span class="nf">dsp</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">make_upwind_sparsity_pattern</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="n">dsp</span><span class="p">);</span>
</pre></div>
</div>
<p>To save memory we distribute the sparsity pattern to only hold the locally
needed set of space-time degrees of freedom.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityTools</span><span class="o">::</span><span class="n">distribute_sparsity_pattern</span><span class="p">(</span>
<span class="w">    </span><span class="n">dsp</span><span class="p">,</span><span class="w"> </span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">,</span><span class="w"> </span><span class="n">slab_locally_relevant_dofs</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">dsp</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="o">-&gt;</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">slab_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-assemble-system-on-slab">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Step3::assemble_system_on_slab</a><a class="headerlink" href="#step3-assemble-system-on-slab" title="Link to this heading"></a></h4>
<p>We only can calculate the contributions of processor local cells.
Otherwise the assembly is the same as in step-1</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::assemble_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEJumpValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">RightHandSide</span><span class="w">      </span><span class="n">right_hand_side</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">dofs_per_cell</span><span class="p">;</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FullMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">     </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">types</span><span class="o">::</span><span class="n">global_dof_index</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_spacetime_dof_index</span><span class="p">(</span>
<span class="w">    </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">n_quadrature_points</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_space</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">quad</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_space</span><span class="w"> </span><span class="o">:</span>
<span class="w">       </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cell_space</span><span class="o">-&gt;</span><span class="n">is_locally_owned</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initial_values</span><span class="p">(</span>
<span class="w">            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_quadrature_points</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get_function_values</span><span class="p">(</span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">                                                             </span><span class="n">initial_values</span><span class="p">);</span>

<span class="w">          </span><span class="n">cell_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">          </span><span class="n">cell_rhs</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_time</span><span class="w"> </span><span class="o">:</span>
<span class="w">               </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell_time</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">();</span>
<span class="w">              </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">              </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">              </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">get_local_dof_indices</span><span class="p">(</span>
<span class="w">                </span><span class="n">local_spacetime_dof_index</span><span class="p">);</span>

<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="n">right_hand_side</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span>
<span class="w">                    </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">time_quadrature_point</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x_q</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">space_quadrature_point</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((\partial_t u,v)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_dt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((\nabla u, \nabla v)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_space_grad</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_space_grad</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                      </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">right_hand_side</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">x_q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// quad</span>

<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_space</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((u^+, v^+)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(-(u^-, v^+)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                            </span><span class="p">{</span>
<span class="w">                              </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                                </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                          </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_minus</span><span class="p">(</span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                           </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(-(u_0,v^+)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">initial_values</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="c1">// value of previous solution</span>
<span class="w">                            </span><span class="o">*</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell time</span>
<span class="w">          </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute_local_to_global</span><span class="p">(</span>
<span class="w">            </span><span class="n">cell_matrix</span><span class="p">,</span>
<span class="w">            </span><span class="n">cell_rhs</span><span class="p">,</span>
<span class="w">            </span><span class="n">local_spacetime_dof_index</span><span class="p">,</span>
<span class="w">            </span><span class="n">slab_system_matrix</span><span class="p">,</span>
<span class="w">            </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell space</span>
</pre></div>
</div>
<p>We need to communicate local contributions to other processors after
assembly</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorOperation</span><span class="o">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorOperation</span><span class="o">::</span><span class="n">add</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-solve-system-on-slab">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Step3::solve_system_on_slab</a><a class="headerlink" href="#step3-solve-system-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::solve_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<p>The interface needs a solver control that is practically irrelevant
as we use a direct solver without convergence criterion</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SolverControl</span><span class="w"> </span><span class="nf">sc</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0e-14</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Amesos_Klu is always installed with Trilinos Amesos.
Note that both SuperLU_dist and MUMPS might have a better performance.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SolverDirect</span><span class="o">::</span><span class="n">AdditionalData</span><span class="w"> </span><span class="n">ad</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span>
<span class="w">                                                            </span><span class="s">&quot;Amesos_Klu&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SolverDirect</span><span class="w">                 </span><span class="nf">solver</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">);</span>
</pre></div>
</div>
<p>In this interface the factorization step is called initialize</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">slab_system_matrix</span><span class="p">);</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">slab_owned_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute</span><span class="p">(</span><span class="n">slab_owned_tmp</span><span class="p">);</span>
</pre></div>
</div>
<p>The solver can only write into a vector with locally owned dofs
so we need to communicate that result between the processors</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_owned_tmp</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-process-results-on-slab">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Step3::process_results_on_slab</a><a class="headerlink" href="#step3-process-results-on-slab" title="Link to this heading"></a></h4>
<p>Here, we add the local contribution to
<span class="math notranslate nohighlight">\((u-u_{kh},u-u_{kh})_{L^2(Q)}=||u-u_{kh}||_{L^2(Q)}^2\)</span>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::process_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">L2_sqr_error</span><span class="w"> </span><span class="o">+=</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">calculate_L2L2_squared_error_on_slab</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">      </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">exact_solution</span><span class="p">,</span><span class="w"> </span><span class="n">quad</span>

<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step3-output-results-on-slab">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">Step3::output_results_on_slab</a><a class="headerlink" href="#step3-output-results-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step3::output_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">();</span>
</pre></div>
</div>
<p>To distinguish output between the different support types we append the
name to the output filename</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">support_type</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Lobatto&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Legendre</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Legendre&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauLeft</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RadauLeft&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RadauRight&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_dofs</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data_out</span><span class="p">;</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">attach_dof_handler</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">local_solution</span><span class="p">;</span>
<span class="w">      </span><span class="n">local_solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">local_solution</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">i</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">add_data_vector</span><span class="p">(</span><span class="n">local_solution</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Solution&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">build_patches</span><span class="p">();</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">filename</span><span class="p">;</span>
<span class="w">      </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;solution_&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">support_type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;_cG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)dG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)_t_&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.vtu&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>instead of a vtk we use the parallel write function</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">write_vtu_in_parallel</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="the-main-function">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">The main function</a><a class="headerlink" href="#the-main-function" title="Link to this heading"></a></h3>
<p>We want to be able to do paramter studies without having to recompile the
whole program. An option would be the ParameterHandler class of deal.II,
but passing command line arguments makes the study easier to automate.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
</pre></div>
</div>
<p>With MPI we need to begin with an InitFinalize call.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Utilities</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">MPI_InitFinalize</span><span class="w"> </span><span class="nf">mpi</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Trilinos Teuchos offers a nice interface to specify and parse command line
arguments.
Single options are added using one of the various <code class="docutils literal notranslate"><span class="pre">setOption</span></code> methods.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="w"> </span><span class="n">clp</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setDocString</span><span class="p">(</span><span class="s">&quot;This example program demonstrates solving the heat &quot;</span>
<span class="w">                   </span><span class="s">&quot;equation with Trilinos + MPI&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">write_vtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;write-vtu&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;no-vtu&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">write_vtu</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Write results into vtu files?&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Finite element orders for cG(s)dG(r) element.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spatial FE degree&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;temporal FE degree&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Number of temporal elements</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of temporal elements&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Number of spatial refinements resulting in <span class="math notranslate nohighlight">\(h = 0.5^(n_{\text{ref})\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n_ref_space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;n-ref-space&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of spatial refinements&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Which temporal support type do we want to use?</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w">       </span><span class="n">st</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">st_values</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Legendre</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauLeft</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauRight</span><span class="p">};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">st_names</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Lobatto&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Legendre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RadauLeft&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RadauRight&quot;</span><span class="p">};</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;support-type&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">st</span><span class="p">,</span>
<span class="w">                </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                </span><span class="n">st_values</span><span class="p">,</span>
<span class="w">                </span><span class="n">st_names</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Location of temporal FE support points&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">throwExceptions</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">  </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">EParseCommandLineReturn</span><span class="w"> </span><span class="n">parse_return</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">clp</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parse_return</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">PARSE_HELP_PRINTED</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// don&#39;t fail if the program was called with ``--help``.</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parse_return</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">PARSE_SUCCESSFUL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Error!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">Step3</span><span class="w"> </span><span class="n">problem</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">write_vtu</span><span class="p">);</span>
<span class="w">  </span><span class="n">problem</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="results">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Results</a><a class="headerlink" href="#results" title="Link to this heading"></a></h2>
<p>As in the previous steps, we start with a video of the solution:</p>
<video autoplay="True" controls="True" height="500" loop="True" preload="auto"><source src="../_images/step-3.ogv" type="video/ogg"></video><p>The <code class="docutils literal notranslate"><span class="pre">.vtu</span></code> files used to produce this animation have again been obtained by
running the program with default parameters.</p>
<section id="convergence-studies">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Convergence studies</a><a class="headerlink" href="#convergence-studies" title="Link to this heading"></a></h3>
<p>As <span class="math notranslate nohighlight">\(u\)</span> is nonlinear we can use it to study the convergence behaviour of
the different discretizations, namely dG(0) to dG(2) with bilinear Q1 elements
in space as well as dG(2) with biquadratic elements.
To get a better understanding we will look at uniform refinement only in time
or space with a sufficently small mesh in the other dimensions
as well as uniform space-time refinement.</p>
<p>To make the following results easier to produce we provide to scripts in
the <a class="reference external" href="https://www.r-project.org/">R language</a>.
Both assume that you have built the executable <cite>out-of-source</cite>
by calling <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-S.</span> <span class="pre">-Bbuild</span></code> in the configure stage.
We recommend setting the build type to reduce with
<code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-S.</span> <span class="pre">-Bbuild</span> <span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code> to get the best performance.
Depending on your system the simulations might still run a few hours,
The first, <code class="docutils literal notranslate"><span class="pre">run_simuatlions.R</span></code> starts by defining some convenience
functions.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">simulationcall</span></code> for constructing the calls to <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>, if you want/have
to use more/less cores for the simulations you can change <code class="docutils literal notranslate"><span class="pre">num_mpi_cores</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runsim</span></code> for running through a set of spatial and temporal refinement
parameters and saving their respective results in <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*_refinement</span></code> for constructing the parameter sets to pass to <code class="docutils literal notranslate"><span class="pre">runsim</span></code>
depending on the type of refinement.</p></li>
</ul>
<p>Finally, the script calls these refinement functions for the different
discretization choices with Gauss-Lobatto support points.
As well as k-refinement for at least piecewise linear temporal
elements for all support types to compare them.</p>
<section id="h-refinement">
<h4><a class="toc-backref" href="#id26" role="doc-backlink">h-refinement</a><a class="headerlink" href="#h-refinement" title="Link to this heading"></a></h4>
<p>All (spatial) h-refinement runs start at the same spatial refinement level (4),
but have different temporal meshes such that the <span class="math notranslate nohighlight">\(L^2\)</span>-errors are similar
enough to fit in the same plot.</p>
<p>As we can see from the following image, all refinements with bilinear elements
start parallel to each other. This is of course expected as the spatial
convergence order does not depend on the temporal discretization.
However, we see that the curve for dG(0) elements stagnates.
This is due to the fact that the overall <span class="math notranslate nohighlight">\(L^2\)</span>-error is composed of a
spatial and a temporal part. Since we do not refine the temporal mesh,
the temporal error dominates for dG(0) and the overall error converges to that
part.</p>
<img alt="../_images/h_convergence_step-3.svg" src="../_images/h_convergence_step-3.svg" />
</section>
<section id="k-refinement">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">k-refinement</a><a class="headerlink" href="#k-refinement" title="Link to this heading"></a></h4>
<p>For the (temporal) k-refinement, all runs start with 10 temporal elements.
The spatial refinement is chosen in a way that all runs have the same amount of
spatial DoFs, i.e. 7 refinement steps for bilinear and 6 for biquadratic
elements.
We can again see that elements of the same order exhibit the same
overall convergence behaviour. Here, due to the number of spatial DoFs being
identical, the curves for dG(2) are even overlapping in the first few steps.
In this figure we can see the dominance of the non-refined error part even more
clearly, as the dG(1) and dG(2) curve for bilinear elements converge to the same
value. As the dG(0) curve is still above that error we don’t yet see a stagnation.
Additionally, we see that the curve for the biquadratic elements also stagnates,
but to a lower value.</p>
<img alt="../_images/k_convergence_step-3.svg" src="../_images/k_convergence_step-3.svg" />
</section>
<section id="kh-refinement">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">kh-refinement</a><a class="headerlink" href="#kh-refinement" title="Link to this heading"></a></h4>
<p>For the uniform (space-time) kh-refinement we again start at 4 spatial
refinement levels for all element combinations and use different initial
temporal meshes to plot the curves close to each other.
We can see three different convergence orders and we can see
that the overall convergence is determined by the minimum of the
spatial and temporal convergence order as a dG(2) discretization for
bilinear elements produces about the same errors, but with <span class="math notranslate nohighlight">\(3/2\)</span>
of the amount of unknowns. More precisely, the relative error
between cG(1)dG(1) and cG(1)dG(2) is around 1%  on the same space-time mesh.</p>
<p>To conclude, we see that matching the temporal and spatial element orders is
important for achieving the optimal convergence.
Luckily, due to the construction of the tensor product elements it is also easy
to match the orders.</p>
<img alt="../_images/kh_convergence_step-3.svg" src="../_images/kh_convergence_step-3.svg" />
</section>
<section id="comparison-of-support-types">
<h4><a class="toc-backref" href="#id29" role="doc-backlink">Comparison of support types</a><a class="headerlink" href="#comparison-of-support-types" title="Link to this heading"></a></h4>
<p>Finally, we have run the k-refinement studies for the different choices
of support points and compared the results to the Gauss-Lobatto runs.
The tables below give the factor between the respective support point
results and the Lobatto results in percent,
i.e. <span class="math notranslate nohighlight">\(100*L^2_{\text{other}}/L^2_{\text{Lobatto}\)</span>.
We can see that for an increasing number of temporal elements
and for higher order discretizations,
the choice of support points gets less important for this particular problem.
However, we see that the left Gauss-Radau rule consistently yields
the lowest <span class="math notranslate nohighlight">\(L^2\)</span>-error, followed by Gauss-Legendre and
the right Gauss-Radau rule.
When keeping in mind that the left Gauss-Radau rule also has
the second smallest sparsity pattern (after Gauss-Lobatto),
it makes it clear that choosing a different support type than Gauss-Lobatto
might be worthwhile depending on the problem.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">cG(1)dG(1)</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>#DoFs</p></th>
<th class="head"><p>RadauLeft</p></th>
<th class="head"><p>Legendre</p></th>
<th class="head"><p>RadauRight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>332820</p></td>
<td><p>96.62%</p></td>
<td><p>97.04%</p></td>
<td><p>98.52%</p></td>
</tr>
<tr class="row-odd"><td><p>665640</p></td>
<td><p>96.86%</p></td>
<td><p>97.62%</p></td>
<td><p>99.03%</p></td>
</tr>
<tr class="row-even"><td><p>1331280</p></td>
<td><p>97.37%</p></td>
<td><p>97.98%</p></td>
<td><p>99.02%</p></td>
</tr>
<tr class="row-odd"><td><p>2662560</p></td>
<td><p>97.87%</p></td>
<td><p>98.20%</p></td>
<td><p>98.77%</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">cG(1)dG(2)</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>#DoFs</p></th>
<th class="head"><p>RadauLeft</p></th>
<th class="head"><p>Legendre</p></th>
<th class="head"><p>RadauRight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>499230</p></td>
<td><p>99.22%</p></td>
<td><p>99.30%</p></td>
<td><p>99.85%</p></td>
</tr>
<tr class="row-odd"><td><p>998460</p></td>
<td><p>99.25%</p></td>
<td><p>99.31%</p></td>
<td><p>99.71%</p></td>
</tr>
<tr class="row-even"><td><p>1996920</p></td>
<td><p>99.79%</p></td>
<td><p>99.81%</p></td>
<td><p>99.91%</p></td>
</tr>
<tr class="row-odd"><td><p>3993840</p></td>
<td><p>99.75%</p></td>
<td><p>99.79%</p></td>
<td><p>99.99%</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">cG(2)dG(2)</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>#DoFs</p></th>
<th class="head"><p>RadauLeft</p></th>
<th class="head"><p>Legendre</p></th>
<th class="head"><p>RadauRight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>499230</p></td>
<td><p>99.22%</p></td>
<td><p>99.30%</p></td>
<td><p>99.86%</p></td>
</tr>
<tr class="row-odd"><td><p>998460</p></td>
<td><p>99.23%</p></td>
<td><p>99.29%</p></td>
<td><p>99.72%</p></td>
</tr>
<tr class="row-even"><td><p>1996920</p></td>
<td><p>99.32%</p></td>
<td><p>99.42%</p></td>
<td><p>99.72%</p></td>
</tr>
<tr class="row-odd"><td><p>3993840</p></td>
<td><p>99.75%</p></td>
<td><p>99.80%</p></td>
<td><p>99.92%</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="the-plain-program">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">The plain program</a><a class="headerlink" href="#the-plain-program" title="Link to this heading"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/distributed/fixed_tria.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/lac/spacetime_trilinos_vector.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/quadrature_lib.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/time_iterator.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/slab_dof_tools.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/spacetime_dof_handler.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/fe_dg.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/spacetime_fe_values.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/numerics/vector_tools.hh&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">DGFE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>


<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/conditional_ostream.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/function.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/distributed/tria.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_q.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_generator.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/dynamic_sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/full_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparsity_tools.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_solver.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_sparse_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/trilinos_vector.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/vector.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/numerics/data_out.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Teuchos_CommandLineProcessor.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExactSolution</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">ExactSolution</span><span class="p">()</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">  </span><span class="p">{}</span>
<span class="w">  </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">ExactSolution::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                     </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span>
<span class="w">         </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">50.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RightHandSide</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">RightHandSide::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">             </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                     </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">double</span><span class="w">       </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">  </span><span class="kt">double</span><span class="w">       </span><span class="n">a</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">50.</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">1.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">));</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">dtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">))</span><span class="w"> </span><span class="o">-</span>
<span class="w">                 </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)))</span><span class="w"> </span><span class="o">/</span>
<span class="w">               </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">u_xx</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">-2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                  </span><span class="p">(</span><span class="mf">-2.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)));</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">u_yy</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="mf">-2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                  </span><span class="p">(</span><span class="mf">-2.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">divisor</span><span class="p">)));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dtu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">u_xx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_yy</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Step3</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">Step3</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">spatial_degree</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">n_ref_space</span><span class="p">,</span>
<span class="w">        </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">support_type</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w">               </span><span class="n">write_vtu</span><span class="p">);</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">run</span><span class="p">();</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">time_marching</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setup_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">solve_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">process_results_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">output_results_on_slab</span><span class="p">();</span>

<span class="w">  </span><span class="n">MPI_Comm</span><span class="w">     </span><span class="n">mpi_comm</span><span class="p">;</span><span class="w">    </span><span class="c1">// MPI Communicator</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w">           </span><span class="c1">// Number of temporal elements</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">;</span><span class="w"> </span><span class="c1">// number of spatial refinements</span>
<span class="w">  </span><span class="kt">bool</span><span class="w">         </span><span class="n">write_vtu</span><span class="p">;</span><span class="w">   </span><span class="c1">// output results?</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">ConditionalOStream</span><span class="w"> </span><span class="n">pout</span><span class="p">;</span><span class="w"> </span><span class="c1">// To allow output only on MPI rank 0</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">fixed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="w">                                     </span><span class="n">triangulation</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DoFHandler</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">  </span><span class="n">dof_handler</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">TrilinosVector</span><span class="w"> </span><span class="n">solution</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityPattern</span><span class="w">                            </span><span class="n">slab_sparsity_pattern</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SparseMatrix</span><span class="w">             </span><span class="n">slab_system_matrix</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w">              </span><span class="n">slab_system_rhs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w">              </span><span class="n">slab_initial_value</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">slab</span><span class="p">;</span>
<span class="w">  </span><span class="n">ExactSolution</span><span class="w">                                      </span><span class="n">exact_solution</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w">                                             </span><span class="n">L2_sqr_error</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">dofs_total</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">slab_locally_owned_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">slab_locally_relevant_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">space_locally_owned_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">IndexSet</span><span class="w">                      </span><span class="n">space_locally_relevant_dofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">slab_owned_tmp</span><span class="p">;</span>

<span class="w">  </span><span class="k">struct</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">TriaIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tria</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFHandlerIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">                  </span><span class="n">dof</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">TrilinosVectorIterator</span><span class="w">                 </span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">slab_its</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">Step3</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">spatial_degree</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">M</span><span class="p">,</span>
<span class="w">             </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="n">n_ref_space</span><span class="p">,</span>
<span class="w">             </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">support_type</span><span class="p">,</span>
<span class="w">             </span><span class="kt">bool</span><span class="w">               </span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">pout</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Utilities</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">this_mpi_process</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">triangulation</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">spatial_degree</span><span class="p">),</span>
<span class="w">       </span><span class="n">temporal_degree</span><span class="p">,</span>
<span class="w">       </span><span class="n">support_type</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">(</span><span class="n">n_ref_space</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">write_vtu</span><span class="p">(</span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">slab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">exact_solution</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">L2_sqr_error</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dofs_total</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as before</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="n">time_marching</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">make_grid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">space_tria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// Construct an MPI parallel triangulation</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">parallel</span><span class="o">::</span><span class="n">distributed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridGenerator</span><span class="o">::</span><span class="n">hyper_cube</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">space_tria</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">refine_global</span><span class="p">(</span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">time_marching</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="n">solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">triangulation</span><span class="p">.</span><span class="n">M</span><span class="p">());</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">triangulation</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dof_handler</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solution</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******Starting time-stepping*********&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="o">!</span><span class="n">tic</span><span class="p">.</span><span class="n">at_end</span><span class="p">();</span><span class="w"> </span><span class="n">tic</span><span class="p">.</span><span class="n">increment</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Starting time-step (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">startpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">      </span><span class="n">setup_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">solve_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">process_results_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">write_vtu</span><span class="p">)</span>
<span class="w">        </span><span class="n">output_results_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_point</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">());</span>
<span class="w">      </span><span class="n">slab</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">L2_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">L2_sqr_error</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Total number of space-time DoFs:</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">dofs_total</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;L2_error:</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">L2_error</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">setup_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">distribute_dofs</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="w">  </span><span class="n">pout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Number of degrees of freedom: </span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">()</span>
<span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (space) * &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">()</span>
<span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (time) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="n">dofs_total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">();</span>
<span class="w">  </span><span class="n">space_locally_owned_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">locally_owned_dofs</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">extract_locally_relevant_dofs</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">(),</span>
<span class="w">                                                  </span><span class="n">space_locally_relevant_dofs</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_locally_owned_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">locally_owned_dofs</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_locally_relevant_dofs</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">extract_locally_relevant_dofs</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_owned_tmp</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">slab</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                                </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                                </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">      </span><span class="n">tmp</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">      </span><span class="n">exact_solution</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">(),</span>
<span class="w">                                       </span><span class="n">exact_solution</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">tmp</span><span class="p">);</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">slab_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">exact_solution</span><span class="p">,</span>
<span class="w">    </span><span class="n">slab_constraints</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DynamicSparsityPattern</span><span class="w"> </span><span class="nf">dsp</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">make_upwind_sparsity_pattern</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="n">dsp</span><span class="p">);</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityTools</span><span class="o">::</span><span class="n">distribute_sparsity_pattern</span><span class="p">(</span>
<span class="w">    </span><span class="n">dsp</span><span class="p">,</span><span class="w"> </span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">,</span><span class="w"> </span><span class="n">slab_locally_relevant_dofs</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">dsp</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="o">-&gt;</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">slab_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_locally_owned_dofs</span><span class="p">,</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">assemble_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEJumpValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">RightHandSide</span><span class="w">      </span><span class="n">right_hand_side</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">dofs_per_cell</span><span class="p">;</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FullMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">     </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">types</span><span class="o">::</span><span class="n">global_dof_index</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_spacetime_dof_index</span><span class="p">(</span>
<span class="w">    </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">n_quadrature_points</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_space</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">quad</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_space</span><span class="w"> </span><span class="o">:</span>
<span class="w">       </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cell_space</span><span class="o">-&gt;</span><span class="n">is_locally_owned</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initial_values</span><span class="p">(</span>
<span class="w">            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_quadrature_points</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get_function_values</span><span class="p">(</span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">                                                             </span><span class="n">initial_values</span><span class="p">);</span>

<span class="w">          </span><span class="n">cell_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">          </span><span class="n">cell_rhs</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_time</span><span class="w"> </span><span class="o">:</span>
<span class="w">               </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell_time</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">();</span>
<span class="w">              </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">              </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">              </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">get_local_dof_indices</span><span class="p">(</span>
<span class="w">                </span><span class="n">local_spacetime_dof_index</span><span class="p">);</span>

<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="n">right_hand_side</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span>
<span class="w">                    </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">time_quadrature_point</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x_q</span><span class="w"> </span><span class="o">=</span>
<span class="w">                    </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">space_quadrature_point</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_dt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_space_grad</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_space_grad</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                      </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">shape_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">right_hand_side</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">x_q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// quad</span>

<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_space</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                            </span><span class="p">{</span>
<span class="w">                              </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                                </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                          </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_minus</span><span class="p">(</span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                           </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                                </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>
<span class="w">                      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">shape_value_plus</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">initial_values</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="c1">// value of previous solution</span>
<span class="w">                            </span><span class="o">*</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell time</span>
<span class="w">          </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute_local_to_global</span><span class="p">(</span>
<span class="w">            </span><span class="n">cell_matrix</span><span class="p">,</span>
<span class="w">            </span><span class="n">cell_rhs</span><span class="p">,</span>
<span class="w">            </span><span class="n">local_spacetime_dof_index</span><span class="p">,</span>
<span class="w">            </span><span class="n">slab_system_matrix</span><span class="p">,</span>
<span class="w">            </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell space</span>

<span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorOperation</span><span class="o">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">VectorOperation</span><span class="o">::</span><span class="n">add</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">solve_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SolverControl</span><span class="w"> </span><span class="nf">sc</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0e-14</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SolverDirect</span><span class="o">::</span><span class="n">AdditionalData</span><span class="w"> </span><span class="n">ad</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span>
<span class="w">                                                            </span><span class="s">&quot;Amesos_Klu&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">SolverDirect</span><span class="w">                 </span><span class="nf">solver</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">);</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">slab_system_matrix</span><span class="p">);</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">slab_owned_tmp</span><span class="p">,</span><span class="w"> </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute</span><span class="p">(</span><span class="n">slab_owned_tmp</span><span class="p">);</span>
<span class="w">  </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_owned_tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">process_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">L2_sqr_error</span><span class="w"> </span><span class="o">+=</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">calculate_L2L2_squared_error_on_slab</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">      </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">exact_solution</span><span class="p">,</span><span class="w"> </span><span class="n">quad</span>

<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span>
<span class="n">Step3</span><span class="o">::</span><span class="n">output_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">();</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">support_type</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Lobatto&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Legendre</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Legendre&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauLeft</span><span class="p">)</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RadauLeft&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">support_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RadauRight&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_dofs</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data_out</span><span class="p">;</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">attach_dof_handler</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">TrilinosWrappers</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="n">local_solution</span><span class="p">;</span>
<span class="w">      </span><span class="n">local_solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">space_locally_owned_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">space_locally_relevant_dofs</span><span class="p">,</span>
<span class="w">                            </span><span class="n">mpi_comm</span><span class="p">);</span>

<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">local_solution</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">i</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">add_data_vector</span><span class="p">(</span><span class="n">local_solution</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Solution&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">build_patches</span><span class="p">();</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">filename</span><span class="p">;</span>
<span class="w">      </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;solution_&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">support_type</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;_cG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)dG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)_t_&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.vtu&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">write_vtu_in_parallel</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">mpi_comm</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Utilities</span><span class="o">::</span><span class="n">MPI</span><span class="o">::</span><span class="n">MPI_InitFinalize</span><span class="w"> </span><span class="nf">mpi</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">  </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="w"> </span><span class="n">clp</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setDocString</span><span class="p">(</span><span class="s">&quot;This example program demonstrates solving the heat &quot;</span>
<span class="w">                   </span><span class="s">&quot;equation with Trilinos + MPI&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">write_vtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;write-vtu&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;no-vtu&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">write_vtu</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Write results into vtu files?&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spatial FE degree&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;temporal FE degree&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of temporal elements&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n_ref_space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;n-ref-space&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of spatial refinements&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w">       </span><span class="n">st</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="w"> </span><span class="n">st_values</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Lobatto</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">Legendre</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauLeft</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">DGFE</span><span class="o">::</span><span class="n">support_type</span><span class="o">::</span><span class="n">RadauRight</span><span class="p">};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">st_names</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Lobatto&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Legendre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RadauLeft&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RadauRight&quot;</span><span class="p">};</span>
<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">setOption</span><span class="p">(</span><span class="s">&quot;support-type&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">st</span><span class="p">,</span>
<span class="w">                </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                </span><span class="n">st_values</span><span class="p">,</span>
<span class="w">                </span><span class="n">st_names</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Location of temporal FE support points&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">clp</span><span class="p">.</span><span class="n">throwExceptions</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">  </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">EParseCommandLineReturn</span><span class="w"> </span><span class="n">parse_return</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">clp</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parse_return</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">PARSE_HELP_PRINTED</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// don&#39;t fail if the program was called with ``--help``.</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parse_return</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Teuchos</span><span class="o">::</span><span class="n">CommandLineProcessor</span><span class="o">::</span><span class="n">PARSE_SUCCESSFUL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Error!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">Step3</span><span class="w"> </span><span class="n">problem</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">n_ref_space</span><span class="p">,</span><span class="w"> </span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">write_vtu</span><span class="p">);</span>
<span class="w">  </span><span class="n">problem</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<div role="list" class="citation-list">
<div class="citation" id="hartmann1998" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Hartmann1998<span class="fn-bracket">]</span></span>
<p>Hartmann, R. <em>A- posteriori Fehlerschätzung und adaptive Schrittweiten- und Ortsgittersteuerung bei Galerkin-Verfahren für die Wärmeleitungsgleichung</em> Diploma Thesis, University of Heidelberg, 1998</p>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="step-2.html" class="btn btn-neutral float-left" title="Example 2: Solving the linear Stokes equation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="step-4.html" class="btn btn-neutral float-right" title="Example 4: Solving the Navier-Stokes equations in parallel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, the ideal.II authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>