

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 2: Solving the linear Stokes equation &mdash; ideal.II  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/maths_admonition.css?v=597dd67d" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example 3: Solving the heat equation in parallel" href="step-3.html" />
    <link rel="prev" title="Example 1: Solving the heat equation" href="step-1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #450d54" >

          
          
          <a href="../index.html">
            
              <img src="../_static/idealii_logo_text.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get ideal.II</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mathematical foundations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../maths/function_spaces.html">Space-time function spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maths/discretization.html">Finite element discretization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Example overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="step-1.html">Example 1: Solving the heat equation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example 2: Solving the linear Stokes equation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#weak-formulations-of-the-stokes-equation">Weak formulations of the Stokes equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problem-statement">Problem statement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#technical-details">Technical details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#non-zero-dirichlet-boundary-conditions">Non-zero Dirichlet boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-vector-valued-problems">Handling vector valued problems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-commented-program">The commented program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#include-files">include files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ideal-ii-includes">ideal.II includes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deal-ii-includes">deal.II includes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-includes">C++ includes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#space-time-functions">Space-time functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-step2-class">The Step2 class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step2-step2">Step2::Step2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-run">Step2::run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-make-grid">Step2::make_grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-time-marching">Step2::time_marching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-setup-system-on-slab">Step2::setup_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-assemble-system-on-slab">Step2::assemble_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-solve-system-on-slab">Step2::solve_system_on_slab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step2-output-results-on-slab">Step2::output_results_on_slab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-main-function">The main function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-plain-program">The plain program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="step-3.html">Example 3: Solving the heat equation in parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="step-4.html">Example 4: Solving the Navier-Stokes equations in parallel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Doxygen API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/index.html">Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/namespaces.html">Namespace List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/classes.html">Class List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://instatdealii.github.io/idealii/dev/doxygen/files.html">File List</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #450d54" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ideal.II</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example 2: Solving the linear Stokes equation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/step-2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-2-solving-the-linear-stokes-equation">
<span id="step-2"></span><h1>Example 2: Solving the linear Stokes equation<a class="headerlink" href="#example-2-solving-the-linear-stokes-equation" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#weak-formulations-of-the-stokes-equation" id="id3">Weak formulations of the Stokes equation</a></p></li>
<li><p><a class="reference internal" href="#problem-statement" id="id4">Problem statement</a></p></li>
<li><p><a class="reference internal" href="#technical-details" id="id5">Technical details</a></p>
<ul>
<li><p><a class="reference internal" href="#non-zero-dirichlet-boundary-conditions" id="id6">Non-zero Dirichlet boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#handling-vector-valued-problems" id="id7">Handling vector valued problems</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-commented-program" id="id8">The commented program</a></p>
<ul>
<li><p><a class="reference internal" href="#include-files" id="id9">include files</a></p>
<ul>
<li><p><a class="reference internal" href="#ideal-ii-includes" id="id10">ideal.II includes</a></p></li>
<li><p><a class="reference internal" href="#deal-ii-includes" id="id11">deal.II includes</a></p></li>
<li><p><a class="reference internal" href="#c-includes" id="id12">C++ includes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#space-time-functions" id="id13">Space-time functions</a></p></li>
<li><p><a class="reference internal" href="#the-step2-class" id="id14">The Step2 class</a></p>
<ul>
<li><p><a class="reference internal" href="#step2-step2" id="id15">Step2::Step2</a></p></li>
<li><p><a class="reference internal" href="#step2-run" id="id16">Step2::run</a></p></li>
<li><p><a class="reference internal" href="#step2-make-grid" id="id17">Step2::make_grid</a></p></li>
<li><p><a class="reference internal" href="#step2-time-marching" id="id18">Step2::time_marching</a></p></li>
<li><p><a class="reference internal" href="#step2-setup-system-on-slab" id="id19">Step2::setup_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step2-assemble-system-on-slab" id="id20">Step2::assemble_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step2-solve-system-on-slab" id="id21">Step2::solve_system_on_slab</a></p></li>
<li><p><a class="reference internal" href="#step2-output-results-on-slab" id="id22">Step2::output_results_on_slab</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-main-function" id="id23">The main function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#results" id="id24">Results</a></p></li>
<li><p><a class="reference internal" href="#the-plain-program" id="id25">The plain program</a></p></li>
<li><p><a class="reference internal" href="#references" id="id26">References</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>In this tutorial we will look at how <em>ideal.II</em> handles coupled problems.
If you are unfamiliar with coupled problems in general,
we recommend going through
<a class="reference external" href="https://dealii.org/current/doxygen/deal.II/step_22.html">example step-22</a>
of <em>deal.II</em>, which solves the stationary version of the Stokes equation
solved in this tutorial step.</p>
<p>The Stokes equation is a coupled problem between a vector-valued velocity
<span class="math notranslate nohighlight">\(\bf u\in\mathbb{R}^d\)</span> and a scalar-valued pressure <span class="math notranslate nohighlight">\(p\in\mathbb{R}\)</span>.</p>
<div class="admonition-stokes-equation-in-strong-formulation maths-equation admonition" id="maths-equation-0">
<p class="admonition-title">Stokes equation in strong formulation</p>
<p>The strong formulation reads as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\partial_t \mathbf{u} - \nu\Delta\mathbf{u} +\nabla_x p = 0\text{ in }Q \\
\nabla_x\cdot \mathbf{u} = 0 \\
\mathbf{u} = \mathbf{g}_D \text{ on }\Gamma_D\times I\\
\partial_n\mathbf{u} = 0\text{ on }\Gamma_N\times I\\
\mathbf{u} = \mathbf{u}^0 \text{ on }\Omega\times\{0\}\end{split}\]</div>
<p>with kinematic viscosity <span class="math notranslate nohighlight">\(\nu\in\mathbb{R}\)</span>.</p>
</div>
<section id="weak-formulations-of-the-stokes-equation">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Weak formulations of the Stokes equation</a><a class="headerlink" href="#weak-formulations-of-the-stokes-equation" title="Link to this heading"></a></h3>
<p>For the weak formulation we need to choose function spaces for the velocity and
pressure.
For the velocity we will use the vector-valued version of the function space
we used in the heat equation,
i.e. <span class="math notranslate nohighlight">\(\mathbf{u}\in\mathbf{X}=X(I,\mathbf{H}^1_0(\Omega))\)</span>.
For the pressure we use <span class="math notranslate nohighlight">\(p\in Y=L^2(I,L^2(\Omega))\)</span>.</p>
<p>By multiplying the strong formulation with matching test functions
<span class="math notranslate nohighlight">\(\mathbf{v}\in\mathbf{X}, q\in Y\)</span> and integrating over <span class="math notranslate nohighlight">\(Q\)</span>
we obtain:</p>
<div class="admonition-stokes-equation-in-weak-formulation maths-equation admonition" id="maths-equation-1">
<p class="admonition-title">Stokes equation in weak formulation</p>
<p>Find <span class="math notranslate nohighlight">\(\mathbf{u}\in\mathbf{X}+\mathbf{g}_D, p\in Y\)</span>
such that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;(\partial_t \mathbf{u},\mathbf{v})
 + \nu(\nabla_x {\mathbf{u}},\nabla_x \mathbf{v})
 - (p,\nabla_x\cdot \mathbf{v}) \\
 &amp;+ (\nabla_x\cdot\mathbf{u},q) = 0\\
&amp;\mathbf{u}(0,x) = \mathbf{u}^0(x) \text{ in }\Omega\end{split}\]</div>
</div>
<p>As in step-1 we allow for discontinuities between two temporal elements
in the function space for <span class="math notranslate nohighlight">\(\bf{u}\)</span> and obtain:</p>
<div class="admonition-stokes-equation-in-discontinuous-weak-formulation maths-equation admonition" id="maths-equation-2">
<p class="admonition-title">Stokes equation in discontinuous weak formulation</p>
<p>Find <span class="math notranslate nohighlight">\(\mathbf{u}\in\widetilde{\mathbf{X}}+\mathbf{g}_D, p\in Y\)</span>
such that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\sum\limits_{m=1}^M &amp;(\partial_t \bf{u},\bf{v})_{I_m\times\Omega}
+ \nu(\nabla_x {\bf{u}},\nabla_x \bf{v})_{I_m\times\Omega}\\
&amp;- (p,\nabla_x\cdot \bf{v})_{I_m\times\Omega}
+(\nabla_x\cdot\bf{u},q)_{I_m\times\Omega} \\
\sum\limits_{m=0}^M &amp;+ ([\mathbf{u}]_m,\mathbf{v}_m^+)_{I_m\times\Omega}= 0\end{split}\]</div>
</div>
<p>For the temporal discretization we do the same steps as before
and for the spatial discretization we have to use inf-sup stable element
combinations. The simplest of these is the Q2/Q1 Taylor-Hood element
with biquadratic elements for the velocity and bilinear elements for
the pressure.</p>
</section>
<section id="problem-statement">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Problem statement</a><a class="headerlink" href="#problem-statement" title="Link to this heading"></a></h3>
<p>The problem was originally formulated as the 2D-3 benchmark problem for the
nonlinear Navier-Stokes equations in <a class="reference internal" href="#turschaben1996" id="id1"><span>[TurSchaBen1996]</span></a>.
The problem describes laminar flow of a fluid through a channel with a cylindrical
obstacle, as shown in the following image:</p>
<img alt="../_images/channel_domain.svg" src="../_images/channel_domain.svg" />
<p>For the pressure we prescribe homogeneous Neumann conditions
on all  boundaries and for the velocity we prescribe the following:</p>
<ul class="simple">
<li><p>A parabolic velocity profile on the inflow <span class="math notranslate nohighlight">\(\Gamma_\text{in}\)</span></p></li>
<li><p>no-slip,i.e. homogeneous Dirichlet conditon on the obstacle
<span class="math notranslate nohighlight">\(\Gamma_\text{circle}\)</span> and channel walls <span class="math notranslate nohighlight">\(\Gamma_\text{wall}\)</span></p></li>
<li><p>A homogeneous Neumann condition on the outflow <span class="math notranslate nohighlight">\(\Gamma_\text{out}\)</span></p></li>
</ul>
<p>We scale the inflow condition by a sine functions along the
temporal domain <span class="math notranslate nohighlight">\(I=(0,8)\)</span> and obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{u}_x &amp;= \sin(\pi t/8)(6y(H-y))/(H^2)\\
\mathbf{u}_y &amp;= 0\end{split}\]</div>
<p>with channel height <span class="math notranslate nohighlight">\(H=0.41\)</span>.</p>
</section>
<section id="technical-details">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Technical details</a><a class="headerlink" href="#technical-details" title="Link to this heading"></a></h3>
<section id="non-zero-dirichlet-boundary-conditions">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Non-zero Dirichlet boundary conditions</a><a class="headerlink" href="#non-zero-dirichlet-boundary-conditions" title="Link to this heading"></a></h4>
<p>In the previous tutorial we passed a <code class="docutils literal notranslate"><span class="pre">dealii::ZeroFunction</span></code>,
to <code class="docutils literal notranslate"><span class="pre">interpolate_boundary_values</span></code>.
In this tutorial we will define our own <code class="docutils literal notranslate"><span class="pre">PoisseuilleInflow</span></code> function
to pass for the left boundary (id 0) according to the grid file.</p>
<p>The important difference to stationary problems is that we want to
prescribe a time-dependent function.
Conveniently, <em>deal.II</em> already supports time-dependent functions
through the methods <code class="docutils literal notranslate"><span class="pre">set_time()</span></code> and <code class="docutils literal notranslate"><span class="pre">get_time()</span></code> and
they are used internally in <em>ideal.II</em>.</p>
</section>
<section id="handling-vector-valued-problems">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Handling vector valued problems</a><a class="headerlink" href="#handling-vector-valued-problems" title="Link to this heading"></a></h4>
<p>For coupled problems the syntax of the <code class="docutils literal notranslate"><span class="pre">FEValues</span></code> family of functions
is different to <em>deal.II</em>, where you would use</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="nf">velocities</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">dealii</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">&gt;</span><span class="w"> </span><span class="n">phi_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values</span><span class="p">[</span><span class="n">velocities</span><span class="p">].</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p>The call <code class="docutils literal notranslate"><span class="pre">fe_values[velocities]</span></code> returns a reference to a
<code class="docutils literal notranslate"><span class="pre">FEValuesViews</span></code> object, which have to be stored in a local cache.</p>
<p>To reproduces this behaviour, <em>ideal.II</em> would need to store a cache
of caches which is not easy to maintain and expand.
Therefore, appropriate functions for the different extractor types
and respective derivatives are provided and the evaluation of the
basis function instead reads</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="nf">velocities</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">dealii</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">&gt;</span><span class="w"> </span><span class="n">phi_v</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_value</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="the-commented-program">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">The commented program</a><a class="headerlink" href="#the-commented-program" title="Link to this heading"></a></h2>
<section id="include-files">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">include files</a><a class="headerlink" href="#include-files" title="Link to this heading"></a></h3>
<section id="ideal-ii-includes">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">ideal.II includes</a><a class="headerlink" href="#ideal-ii-includes" title="Link to this heading"></a></h4>
<p>same as in step-1</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/quadrature_lib.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/time_iterator.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/slab_dof_tools.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/spacetime_dof_handler.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/fe_dg.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/spacetime_fe_values.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/grid/fixed_tria.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/lac/spacetime_vector.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/numerics/vector_tools.hh&gt;</span>
</pre></div>
</div>
</section>
<section id="deal-ii-includes">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">deal.II includes</a><a class="headerlink" href="#deal-ii-includes" title="Link to this heading"></a></h4>
<p>Same as in step-1</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/function.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_q.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_generator.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/tria.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/dynamic_sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/full_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparse_direct.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparse_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/vector.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/numerics/data_out.h&gt;</span>
</pre></div>
</div>
<p>For extracting the number of velocity and pressure dofs</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/dofs/dof_renumbering.h&gt;</span>
</pre></div>
</div>
<p>For Stokes we have a system of finite elements</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_system.h&gt;</span>
</pre></div>
</div>
<p>For reading grid description files</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_tools.h&gt;</span>
</pre></div>
</div>
<p>Needed to ensure the circle obstacle is refined correctly</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/manifold_lib.h&gt;</span>
</pre></div>
</div>
</section>
<section id="c-includes">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">C++ includes</a><a class="headerlink" href="#c-includes" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="space-time-functions">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Space-time functions</a><a class="headerlink" href="#space-time-functions" title="Link to this heading"></a></h3>
<p>This function describes the Dirichlet data for the inflow boundary,
i.e. a Poiseuille flow or quadratic inflow profile.
Note the use of get_time to obtain t.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PoisseuilleInflow</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">PoisseuilleInflow</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">                    </span><span class="kt">double</span><span class="w"> </span><span class="n">channel_height</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">0.41</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="p">(</span><span class="n">max_inflow_velocity</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">channel_height</span><span class="p">)</span>
<span class="w">  </span><span class="p">{}</span>

<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">vector_value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">H</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">PoisseuilleInflow::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">      </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Assert</span><span class="p">(</span><span class="n">component</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">,</span>
<span class="w">         </span><span class="n">dealii</span><span class="o">::</span><span class="n">ExcIndexRange</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">));</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.41</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">H</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                 </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.125</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">H</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">H</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">PoisseuilleInflow::vector_value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                                </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">values</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The exact solution is unknown, so we can not specify it here.
We don’t need to specify the rhs function as it is zeros for this
configuration.</p>
</section>
<section id="the-step2-class">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">The Step2 class</a><a class="headerlink" href="#the-step2-class" title="Link to this heading"></a></h3>
<p>This class describes the solution of Stokes equations with
space-time slab tensor-product elements</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Step2</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">Step2</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">temporal_degree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">run</span><span class="p">();</span>

<span class="k">private</span><span class="o">:</span><span class="w"> </span><span class="c1">// Nothing new here</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">time_marching</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setup_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">solve_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">output_results_on_slab</span><span class="p">();</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">fixed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">triangulation</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DoFHandler</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">           </span><span class="n">dof_handler</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">          </span><span class="n">solution</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityPattern</span><span class="w">                            </span><span class="n">sparsity_pattern</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparseMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                       </span><span class="n">slab_system_matrix</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                             </span><span class="n">slab_system_rhs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                             </span><span class="n">slab_initial_value</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">slab</span><span class="p">;</span>

<span class="w">  </span><span class="k">struct</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">TriaIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">        </span><span class="n">tria</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFHandlerIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">  </span><span class="n">dof</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorIterator</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">slab_its</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="step2-step2">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Step2::Step2</a><a class="headerlink" href="#step2-step2" title="Link to this heading"></a></h4>
<p>Here, the constructor only takes the temporal degree as argument.
The main change to step-1 is the construction of the finite element <code class="docutils literal notranslate"><span class="pre">fe</span></code>,
which is a continuous Taylor-Hood Q2/Q1 element in space consisting of
* a vector-valued biquadratic element, i.e. Q2, for the velocity,
* a scalar-valued bilinear element, i.e. Q1, for the pressure.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Step2</span><span class="o">::</span><span class="n">Step2</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">temporal_degree</span><span class="p">)</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">triangulation</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">FESystem</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="w">                                             </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">                                             </span><span class="mi">1</span><span class="p">),</span>
<span class="w">       </span><span class="n">temporal_degree</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">slab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{}</span>
</pre></div>
</div>
</section>
<section id="step2-run">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Step2::run</a><a class="headerlink" href="#step2-run" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::run</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as Step1</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="n">time_marching</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-make-grid">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">Step2::make_grid</a><a class="headerlink" href="#step2-make-grid" title="Link to this heading"></a></h4>
<p>In comparison to step-1 this function will read in a grid from file instead
of using a generator.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::make_grid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">space_tria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridIn</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">grid_in</span><span class="p">;</span><span class="w"> </span><span class="c1">// For reading in a mesh from file</span>
<span class="w">  </span><span class="n">grid_in</span><span class="p">.</span><span class="n">attach_triangulation</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="n">input_file</span><span class="p">(</span><span class="s">&quot;nsbench4.inp&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">grid_in</span><span class="p">.</span><span class="n">read_ucd</span><span class="p">(</span><span class="n">input_file</span><span class="p">);</span>
</pre></div>
</div>
<p>The interior obstacle is supposed to be a circle.
However, the input mesh specifies a polyhedron.
To ensure correct refinement we have to tell the triangulation
that this boundary is actually a circle.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">                          </span><span class="n">p</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">SphericalManifold</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">boundary</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridTools</span><span class="o">::</span><span class="n">copy_boundary_to_manifold_id</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">space_tria</span><span class="o">-&gt;</span><span class="n">set_manifold</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">boundary</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">space_tria</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">refine_global</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-time-marching">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Step2::time_marching</a><a class="headerlink" href="#step2-time-marching" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::time_marching</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as in step-1</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="n">solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">triangulation</span><span class="p">.</span><span class="n">M</span><span class="p">());</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">triangulation</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dof_handler</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solution</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******Starting time-stepping*********&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">slab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="o">!</span><span class="n">tic</span><span class="p">.</span><span class="n">at_end</span><span class="p">();</span><span class="w"> </span><span class="n">tic</span><span class="p">.</span><span class="n">increment</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Starting time-step (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">startpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">      </span><span class="n">setup_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">solve_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">output_results_on_slab</span><span class="p">();</span>

<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">      </span><span class="n">slab</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-setup-system-on-slab">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Step2::setup_system_on_slab</a><a class="headerlink" href="#step2-setup-system-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::setup_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">distribute_dofs</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
</pre></div>
</div>
<p>We reorder the DoFs such that all DoFs belonging to a specific
component are arranged together.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFRenumbering</span><span class="o">::</span><span class="n">component_wise</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Number of degrees of freedom: </span><span class="se">\n\t</span><span class="s">&quot;</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (space) * &quot;</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">()</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (time) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">()</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (spacetime)&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">slab</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">());</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">slab_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we have multiple Dirichlet boundaries for the velocity.
The boundary ids are specified in the grid input file.</p>
<ul class="simple">
<li><p>Inhomogenous Poisseuille inflow at the left wall (id 0)</p></li>
<li><p>No-slip condition(<span class="math notranslate nohighlight">\(v=0\)</span>) at both the upper and lower
walls (id 2) as well as the obstacle (id 80).</p></li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">zero</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Functions</span><span class="o">::</span><span class="n">ZeroFunction</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">inflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PoisseuilleInflow</span><span class="p">();</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">component_mask</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">component_mask</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">inflow</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span>
</pre></div>
</div>
<p>Specify coupling between components to save on memory, since the pressure
test and trial functions are not multiplied in the equation.
Therefore, the sparsity can be zero in the pressure-pressure block.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Table</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">Coupling</span><span class="o">&gt;</span><span class="w"> </span><span class="n">coupling_space</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">coupling_space</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">none</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">coupling_space</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(v,p)</span>
<span class="w">      </span><span class="n">coupling_space</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(p,v)</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">coupling_space</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(v,v)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Now we construct a sparsity pattern with the given coupling and
constraints.
Apart from that, the rest of the function is the same as before.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DynamicSparsityPattern</span><span class="w"> </span><span class="nf">dsp</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">make_upwind_sparsity_pattern</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">coupling_space</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">dsp</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">slab_constraints</span><span class="p">);</span>
<span class="w">  </span><span class="n">sparsity_pattern</span><span class="p">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">dsp</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">sparsity_pattern</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="o">-&gt;</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-assemble-system-on-slab">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Step2::assemble_system_on_slab</a><a class="headerlink" href="#step2-assemble-system-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::assemble_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
</pre></div>
</div>
<p>The beginning is the same as before.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEJumpValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">dofs_per_cell</span><span class="p">;</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FullMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">     </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">types</span><span class="o">::</span><span class="n">global_dof_index</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_spacetime_dof_index</span><span class="p">(</span>
<span class="w">    </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">n_quadrature_points</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_space</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">quad</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
</pre></div>
</div>
<p>Set the kinematic viscosity</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">nu_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e-3</span><span class="p">;</span>
</pre></div>
</div>
<p>Specify the type of unknown, i.e. Vector or Scalar and the beginning index
in the <code class="docutils literal notranslate"><span class="pre">FESystem</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="nf">velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Scalar</span><span class="w"> </span><span class="nf">pressure</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>Same as before, we split the space-time element loop into spatial and
temporal components.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_space</span><span class="w"> </span><span class="o">:</span>
<span class="w">       </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">      </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">initial_values</span><span class="p">(</span>
<span class="w">        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_quadrature_points</span><span class="p">);</span>
</pre></div>
</div>
<p>Get the function values of the velocity component of the spatial finite
element.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">[](</span><span class="n">velocity</span><span class="p">).</span><span class="n">get_function_values</span><span class="p">(</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span><span class="w"> </span><span class="n">initial_values</span><span class="p">);</span>

<span class="w">      </span><span class="n">cell_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">cell_rhs</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_time</span><span class="w"> </span><span class="o">:</span>
<span class="w">           </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell_time</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">();</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">get_local_dof_indices</span><span class="p">(</span><span class="n">local_spacetime_dof_index</span><span class="p">);</span>

<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
</pre></div>
</div>
<p>The FEValues calls with extractors are different
to the ones in deal.II to avoid duplicate caching.
Instead of <code class="docutils literal notranslate"><span class="pre">operator[]</span></code> returning a specialized
<code class="docutils literal notranslate"><span class="pre">FEValuesViews</span></code> object, <code class="docutils literal notranslate"><span class="pre">FEValues</span></code> directly offers
functions for scalar and vector valued shape functions.</p>
<p>Example:</p>
<ul class="simple">
<li><p>deal.II: <code class="docutils literal notranslate"><span class="pre">fe_values[velocity].value(i,q)</span></code></p></li>
<li><p>ideal.II: <a href="#id1"><span class="problematic" id="id2">``</span></a>fe_values.vector_value(extractor,i,q)`</p></li>
</ul>
<p><span class="math notranslate nohighlight">\((\partial_t u, v)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_value</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_dt</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((\nabla u, \nabla v)\)</span>
Since the shape function is vector valued,
we have to call <code class="docutils literal notranslate"><span class="pre">scalar_product()</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">dealii</span><span class="o">::</span><span class="n">scalar_product</span><span class="p">(</span>
<span class="w">                          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_space_grad</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">),</span>
<span class="w">                          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_space_grad</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nu_f</span><span class="p">;</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(-(p, \nabla\cdot v)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_divergence</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">scalar_value</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((\nabla\cdot u,q)\)</span> (div free constraint)</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">scalar_value</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_divergence</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="c1">// quad</span>
</pre></div>
</div>
<p>Only the velocity has a temporal derivative, so we don’t need
jump values for the pressure.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_space</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\((u^+, v^+)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(-(u^-, v^+)\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">                      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                       </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                       </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_minus</span><span class="p">(</span>
<span class="w">                              </span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">initial_values</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="c1">// value of previous solution at t0</span>
<span class="w">                        </span><span class="o">*</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell time</span>
<span class="w">      </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute_local_to_global</span><span class="p">(</span><span class="n">cell_matrix</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">cell_rhs</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">local_spacetime_dof_index</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">slab_system_matrix</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell space</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-solve-system-on-slab">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Step2::solve_system_on_slab</a><a class="headerlink" href="#step2-solve-system-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::solve_system_on_slab</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as before</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparseDirectUMFPACK</span><span class="w"> </span><span class="n">solver</span><span class="p">;</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">factorize</span><span class="p">(</span><span class="n">slab_system_matrix</span><span class="p">);</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">vmult</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step2-output-results-on-slab">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">Step2::output_results_on_slab</a><a class="headerlink" href="#step2-output-results-on-slab" title="Link to this heading"></a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">Step2::output_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">();</span>
</pre></div>
</div>
<p>As in deal.II we need to tell the DataOut what to do with the vector and
scalar valued entries in the solution vector.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">field_names</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">dci</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">field_names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;velocity&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dci</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
<span class="w">        </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">component_is_part_of_vector</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="n">field_names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;pressure&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">dci</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">component_is_scalar</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_dofs</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data_out</span><span class="p">;</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">attach_dof_handler</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_solution</span><span class="p">;</span>
<span class="w">      </span><span class="n">local_solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">());</span>
<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">local_solution</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">add_data_vector</span><span class="p">(</span><span class="n">local_solution</span><span class="p">,</span>
<span class="w">                               </span><span class="n">field_names</span><span class="p">,</span>
<span class="w">                               </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">type_dof_data</span><span class="p">,</span>
<span class="w">                               </span><span class="n">dci</span><span class="p">);</span>

<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">build_patches</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">filename</span><span class="p">;</span>
<span class="w">      </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;solution_dG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)_t_&quot;</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.vtk&quot;</span><span class="p">;</span>

<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">write_vtk</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<span class="w">      </span><span class="n">output</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="the-main-function">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">The main function</a><a class="headerlink" href="#the-main-function" title="Link to this heading"></a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Step2</span><span class="w"> </span><span class="n">problem</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">problem</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="results">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Results</a><a class="headerlink" href="#results" title="Link to this heading"></a></h2>
<p>The below videos show the animation of the results for default parameters.
The first shows the velocity magnitude
<span class="math notranslate nohighlight">\(\sqrt{\mathbf{u}_x^2+\mathbf{u}_y^2}\)</span>
and the second shows the pressure.
Since the inflow is scaled by a sine function we can see the
velocity slowly rising at the boundary.</p>
<video autoplay="True" controls="True" height="800" loop="True" preload="auto"><source src="../_images/step-2-velocity.ogv" type="video/ogg"></video><video autoplay="True" controls="True" height="800" loop="True" preload="auto"><source src="../_images/step-2-pressure.ogv" type="video/ogg"></video></section>
<section id="the-plain-program">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">The plain program</a><a class="headerlink" href="#the-plain-program" title="Link to this heading"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/quadrature_lib.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/base/time_iterator.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/slab_dof_tools.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/dofs/spacetime_dof_handler.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/fe_dg.hh&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/fe/spacetime_fe_values.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/grid/fixed_tria.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/lac/spacetime_vector.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ideal.II/numerics/vector_tools.hh&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/base/function.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_q.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_generator.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/tria.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/dynamic_sparsity_pattern.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/full_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparse_direct.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/sparse_matrix.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/lac/vector.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/numerics/data_out.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/dofs/dof_renumbering.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/fe/fe_system.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/grid_tools.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;deal.II/grid/manifold_lib.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>



<span class="k">class</span><span class="w"> </span><span class="nc">PoisseuilleInflow</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">PoisseuilleInflow</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">                    </span><span class="kt">double</span><span class="w"> </span><span class="n">channel_height</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">0.41</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="p">(</span><span class="n">max_inflow_velocity</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">channel_height</span><span class="p">)</span>
<span class="w">  </span><span class="p">{}</span>

<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">double</span>
<span class="w">  </span><span class="n">value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">vector_value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">H</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">double</span>
<span class="nf">PoisseuilleInflow::value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">      </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Assert</span><span class="p">(</span><span class="n">component</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">,</span>
<span class="w">         </span><span class="n">dealii</span><span class="o">::</span><span class="n">ExcIndexRange</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">));</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.41</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_time</span><span class="p">();</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max_inflow_velocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">H</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                 </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.125</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">H</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">H</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">PoisseuilleInflow::vector_value</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span>
<span class="w">                                </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n_components</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">values</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Step2</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">Step2</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">temporal_degree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">run</span><span class="p">();</span>

<span class="k">private</span><span class="o">:</span><span class="w"> </span><span class="c1">// Nothing new here</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">time_marching</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setup_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">solve_system_on_slab</span><span class="p">();</span>
<span class="w">  </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">output_results_on_slab</span><span class="p">();</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">fixed</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">triangulation</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DoFHandler</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">           </span><span class="n">dof_handler</span><span class="p">;</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">          </span><span class="n">solution</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">DG_FiniteElement</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparsityPattern</span><span class="w">                            </span><span class="n">sparsity_pattern</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparseMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                       </span><span class="n">slab_system_matrix</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                             </span><span class="n">slab_system_rhs</span><span class="p">;</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">                             </span><span class="n">slab_initial_value</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">                                       </span><span class="n">slab</span><span class="p">;</span>

<span class="w">  </span><span class="k">struct</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">TriaIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">        </span><span class="n">tria</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFHandlerIterator</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">  </span><span class="n">dof</span><span class="p">;</span>
<span class="w">    </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorIterator</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">solution</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">slab_its</span><span class="p">;</span>
<span class="p">};</span>



<span class="n">Step2</span><span class="o">::</span><span class="n">Step2</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">temporal_degree</span><span class="p">)</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">triangulation</span><span class="p">()</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">FESystem</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="w">                                             </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">dealii</span><span class="o">::</span><span class="n">FE_Q</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">                                             </span><span class="mi">1</span><span class="p">),</span>
<span class="w">       </span><span class="n">temporal_degree</span><span class="p">)</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">slab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as Step1</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">make_grid</span><span class="p">();</span>
<span class="w">  </span><span class="n">time_marching</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">make_grid</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">space_tria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">Triangulation</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridIn</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">grid_in</span><span class="p">;</span><span class="w"> </span><span class="c1">// For reading in a mesh from file</span>
<span class="w">  </span><span class="n">grid_in</span><span class="p">.</span><span class="n">attach_triangulation</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="n">input_file</span><span class="p">(</span><span class="s">&quot;nsbench4.inp&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">grid_in</span><span class="p">.</span><span class="n">read_ucd</span><span class="p">(</span><span class="n">input_file</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Point</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w">                          </span><span class="n">p</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">SphericalManifold</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">boundary</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">GridTools</span><span class="o">::</span><span class="n">copy_boundary_to_manifold_id</span><span class="p">(</span><span class="o">*</span><span class="n">space_tria</span><span class="p">);</span>
<span class="w">  </span><span class="n">space_tria</span><span class="o">-&gt;</span><span class="n">set_manifold</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">boundary</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">space_tria</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="n">triangulation</span><span class="p">.</span><span class="n">refine_global</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">time_marching</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as in step-1</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idealii</span><span class="o">::</span><span class="n">TimeIteratorCollection</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="n">solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">triangulation</span><span class="p">.</span><span class="n">M</span><span class="p">());</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">triangulation</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">dof_handler</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">triangulation</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dof_handler</span><span class="p">);</span>
<span class="w">  </span><span class="n">tic</span><span class="p">.</span><span class="n">add_iterator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">solution</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******Starting time-stepping*********&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">slab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="o">!</span><span class="n">tic</span><span class="p">.</span><span class="n">at_end</span><span class="p">();</span><span class="w"> </span><span class="n">tic</span><span class="p">.</span><span class="n">increment</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Starting time-step (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">startpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">      </span><span class="n">setup_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">assemble_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">solve_system_on_slab</span><span class="p">();</span>
<span class="w">      </span><span class="n">output_results_on_slab</span><span class="p">();</span>

<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span>
<span class="w">        </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">      </span><span class="n">slab</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">setup_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">distribute_dofs</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFRenumbering</span><span class="o">::</span><span class="n">component_wise</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Number of degrees of freedom: </span><span class="se">\n\t</span><span class="s">&quot;</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (space) * &quot;</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">()</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (time) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">()</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (spacetime)&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">slab</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">());</span>
<span class="w">      </span><span class="n">slab_initial_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">slab_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">AffineConstraints</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">zero</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">Functions</span><span class="o">::</span><span class="n">ZeroFunction</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w">              </span><span class="n">inflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PoisseuilleInflow</span><span class="p">();</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">component_mask</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">component_mask</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">inflow</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">interpolate_boundary_values</span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">slab_constraints</span><span class="p">,</span><span class="w"> </span><span class="n">component_mask</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span>


<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Table</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">Coupling</span><span class="o">&gt;</span><span class="w"> </span><span class="n">coupling_space</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">coupling_space</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">none</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">coupling_space</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(v,p)</span>
<span class="w">      </span><span class="n">coupling_space</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(p,v)</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">coupling_space</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">always</span><span class="p">;</span><span class="w"> </span><span class="c1">//(v,v)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">DynamicSparsityPattern</span><span class="w"> </span><span class="n">dsp</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">DoFTools</span><span class="o">::</span><span class="n">make_upwind_sparsity_pattern</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">coupling_space</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">dsp</span><span class="p">,</span>
<span class="w">                                                        </span><span class="n">slab_constraints</span><span class="p">);</span>
<span class="w">  </span><span class="n">sparsity_pattern</span><span class="p">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">dsp</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_system_matrix</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">sparsity_pattern</span><span class="p">);</span>

<span class="w">  </span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="o">-&gt;</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="w">  </span><span class="n">slab_system_rhs</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_spacetime</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">assemble_system_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">QGauss</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quad</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="n">idealii</span><span class="o">::</span><span class="n">spacetime</span><span class="o">::</span><span class="n">FEJumpValues</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">(</span>
<span class="w">    </span><span class="n">fe</span><span class="p">,</span>
<span class="w">    </span><span class="n">quad</span><span class="p">,</span>
<span class="w">    </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_values</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_gradients</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_quadrature_points</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dealii</span><span class="o">::</span><span class="n">update_JxW_values</span><span class="p">);</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">dofs_per_cell</span><span class="p">;</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">tria</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_global_active_cells</span><span class="p">();</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FullMatrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">     </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">types</span><span class="o">::</span><span class="n">global_dof_index</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_spacetime_dof_index</span><span class="p">(</span>
<span class="w">    </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">);</span>

<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">n_quadrature_points</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_quad_space</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">quad</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">nu_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e-3</span><span class="p">;</span>

<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Vector</span><span class="w"> </span><span class="nf">velocity</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">FEValuesExtractors</span><span class="o">::</span><span class="n">Scalar</span><span class="w"> </span><span class="nf">pressure</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>


<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_space</span><span class="w"> </span><span class="o">:</span>
<span class="w">       </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">      </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_space</span><span class="p">(</span><span class="n">cell_space</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">initial_values</span><span class="p">(</span>
<span class="w">        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">n_quadrature_points</span><span class="p">);</span>
<span class="w">      </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">spatial</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">operator</span><span class="p">[](</span><span class="n">velocity</span><span class="p">).</span><span class="n">get_function_values</span><span class="p">(</span>
<span class="w">        </span><span class="n">slab_initial_value</span><span class="p">,</span><span class="w"> </span><span class="n">initial_values</span><span class="p">);</span>

<span class="w">      </span><span class="n">cell_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">cell_rhs</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell_time</span><span class="w"> </span><span class="o">:</span>
<span class="w">           </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">active_cell_iterators</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell_time</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">();</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">reinit_time</span><span class="p">(</span><span class="n">cell_time</span><span class="p">);</span>
<span class="w">          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">get_local_dof_indices</span><span class="p">(</span><span class="n">local_spacetime_dof_index</span><span class="p">);</span>

<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_spacetime</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>

<span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_value</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_dt</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">dealii</span><span class="o">::</span><span class="n">scalar_product</span><span class="p">(</span>
<span class="w">                          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_space_grad</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">),</span>
<span class="w">                          </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_space_grad</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                </span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nu_f</span><span class="p">;</span>

<span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_divergence</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">scalar_value</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">scalar_value</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">vector_divergence</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="c1">// quad</span>

<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_quad_space</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">q</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">j</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>

<span class="w">                      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                          </span><span class="n">cell_matrix</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dofs_per_spacetime_cell</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                       </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                       </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_minus</span><span class="p">(</span>
<span class="w">                              </span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                            </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs j</span>

<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                      </span><span class="n">cell_rhs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span>
<span class="w">                        </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">vector_value_plus</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">i</span><span class="p">,</span>
<span class="w">                                                                   </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span>
<span class="w">                        </span><span class="n">initial_values</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="c1">// value of previous solution at t0</span>
<span class="w">                        </span><span class="o">*</span><span class="w"> </span><span class="n">fe_jump_values_spacetime</span><span class="p">.</span><span class="n">JxW</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="c1">// dofs i</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell time</span>
<span class="w">      </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute_local_to_global</span><span class="p">(</span><span class="n">cell_matrix</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">cell_rhs</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">local_spacetime_dof_index</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">slab_system_matrix</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// cell space</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">solve_system_on_slab</span><span class="p">()</span><span class="w"> </span><span class="c1">// same as before</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">dealii</span><span class="o">::</span><span class="n">SparseDirectUMFPACK</span><span class="w"> </span><span class="n">solver</span><span class="p">;</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">factorize</span><span class="p">(</span><span class="n">slab_system_matrix</span><span class="p">);</span>
<span class="w">  </span><span class="n">solver</span><span class="p">.</span><span class="n">vmult</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">slab_system_rhs</span><span class="p">);</span>
<span class="w">  </span><span class="n">slab_constraints</span><span class="o">-&gt;</span><span class="n">distribute</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">Step2</span><span class="o">::</span><span class="n">output_results_on_slab</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_time</span><span class="p">();</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">field_names</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">dci</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">field_names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;velocity&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dci</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
<span class="w">        </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">component_is_part_of_vector</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="n">field_names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;pressure&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">dci</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">dealii</span><span class="o">::</span><span class="n">DataComponentInterpretation</span><span class="o">::</span><span class="n">component_is_scalar</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_dofs</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data_out</span><span class="p">;</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">attach_dof_handler</span><span class="p">(</span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">spatial</span><span class="p">());</span>
<span class="w">      </span><span class="n">dealii</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">local_solution</span><span class="p">;</span>
<span class="w">      </span><span class="n">local_solution</span><span class="p">.</span><span class="n">reinit</span><span class="p">(</span><span class="n">slab_its</span><span class="p">.</span><span class="n">dof</span><span class="o">-&gt;</span><span class="n">n_dofs_space</span><span class="p">());</span>
<span class="w">      </span><span class="n">idealii</span><span class="o">::</span><span class="n">slab</span><span class="o">::</span><span class="n">VectorTools</span><span class="o">::</span><span class="n">extract_subvector_at_time_dof</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">slab_its</span><span class="p">.</span><span class="n">solution</span><span class="p">,</span><span class="w"> </span><span class="n">local_solution</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">add_data_vector</span><span class="p">(</span><span class="n">local_solution</span><span class="p">,</span>
<span class="w">                               </span><span class="n">field_names</span><span class="p">,</span>
<span class="w">                               </span><span class="n">dealii</span><span class="o">::</span><span class="n">DataOut</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">type_dof_data</span><span class="p">,</span>
<span class="w">                               </span><span class="n">dci</span><span class="p">);</span>

<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">build_patches</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="w"> </span><span class="n">filename</span><span class="p">;</span>
<span class="w">      </span><span class="n">filename</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;solution_dG(&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">temporal</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">degree</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)_t_&quot;</span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">slab</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_dofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.vtk&quot;</span><span class="p">;</span>

<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
<span class="w">      </span><span class="n">data_out</span><span class="p">.</span><span class="n">write_vtk</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<span class="w">      </span><span class="n">output</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Step2</span><span class="w"> </span><span class="nf">problem</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">problem</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<div role="list" class="citation-list">
<div class="citation" id="turschaben1996" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">TurSchaBen1996</a><span class="fn-bracket">]</span></span>
<p>Schäfer, M., Turek, S. et. al <em>Benchmark computations of laminar flow around a cylinder</em> Vieweg+Teubner Verlag, 1996</p>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="step-1.html" class="btn btn-neutral float-left" title="Example 1: Solving the heat equation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="step-3.html" class="btn btn-neutral float-right" title="Example 3: Solving the heat equation in parallel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, the ideal.II authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>